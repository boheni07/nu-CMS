<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nucms.cms.mapper.CmsStatsMapper">

    <insert id="insertPv" parameterType="com.nucms.cms.model.CmsStatsVO">
        INSERT INTO CMS_STATS_PV (
            CONECT_URL, ESNTL_ID, CONECT_IP, REFERER_URL, CONECT_DE
        ) VALUES (
            #{conectUrl}, #{esntlId}, #{conectIp}, #{refererUrl}, DATE_FORMAT(NOW(), '%Y%m%d')
        )
    </insert>

    <!-- 일별 통계 (최근 N일) -->
    <select id="selectDailyStats" parameterType="com.nucms.cms.model.CmsStatsVO" resultType="com.nucms.cms.model.CmsStatsVO">
        SELECT 
            CONECT_DE AS conectDe,
            COUNT(*) AS pvCount,
            COUNT(DISTINCT CONECT_IP) AS userCount
        FROM CMS_STATS_PV
        WHERE CONECT_DE BETWEEN #{startDate} AND #{endDate}
        GROUP BY CONECT_DE
        ORDER BY CONECT_DE ASC
    </select>

    <!-- 메뉴별 통계 (인기 메뉴) -->
    <select id="selectMenuStats" parameterType="com.nucms.cms.model.CmsStatsVO" resultType="com.nucms.cms.model.CmsStatsVO">
        SELECT 
            CONECT_URL AS conectUrl,
            COUNT(*) AS pvCount
        FROM CMS_STATS_PV
        WHERE CONECT_DE BETWEEN #{startDate} AND #{endDate}
        GROUP BY CONECT_URL
        ORDER BY pvCount DESC
        LIMIT 10
    </select>

</mapper>
